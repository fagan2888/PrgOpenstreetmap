<!DOCTYPE html>
<html>
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
  <title>report_toc.html</title>
  <meta name="generator" content="Haroopad 0.13.1" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <style>div.oembedall-githubrepos{border:1px solid #DDD;border-radius:4px;list-style-type:none;margin:0 0 10px;padding:8px 10px 0;font:13.34px/1.4 helvetica,arial,freesans,clean,sans-serif;width:452px;background-color:#fff}div.oembedall-githubrepos .oembedall-body{background:-moz-linear-gradient(center top,#FAFAFA,#EFEFEF);background:-webkit-gradient(linear,left top,left bottom,from(#FAFAFA),to(#EFEFEF));border-bottom-left-radius:4px;border-bottom-right-radius:4px;border-top:1px solid #EEE;margin-left:-10px;margin-top:8px;padding:5px 10px;width:100%}div.oembedall-githubrepos h3{font-size:14px;margin:0;padding-left:18px;white-space:nowrap}div.oembedall-githubrepos p.oembedall-description{color:#444;font-size:12px;margin:0 0 3px}div.oembedall-githubrepos p.oembedall-updated-at{color:#888;font-size:11px;margin:0}div.oembedall-githubrepos ul.oembedall-repo-stats{border:none;float:right;font-size:11px;font-weight:700;padding-left:15px;position:relative;z-index:5;margin:0}div.oembedall-githubrepos ul.oembedall-repo-stats li{border:none;color:#666;display:inline-block;list-style-type:none;margin:0!important}div.oembedall-githubrepos ul.oembedall-repo-stats li a{background-color:transparent;border:none;color:#666!important;background-position:5px -2px;background-repeat:no-repeat;border-left:1px solid #DDD;display:inline-block;height:21px;line-height:21px;padding:0 5px 0 23px}div.oembedall-githubrepos ul.oembedall-repo-stats li:first-child a{border-left:medium none;margin-right:-3px}div.oembedall-githubrepos ul.oembedall-repo-stats li a:hover{background:5px -27px no-repeat #4183C4;color:#FFF!important;text-decoration:none}div.oembedall-githubrepos ul.oembedall-repo-stats li:first-child a:hover{border-bottom-left-radius:3px;border-top-left-radius:3px}ul.oembedall-repo-stats li:last-child a:hover{border-bottom-right-radius:3px;border-top-right-radius:3px}span.oembedall-closehide{background-color:#aaa;border-radius:2px;cursor:pointer;margin-right:3px}div.oembedall-container{margin-top:5px;text-align:left}.oembedall-ljuser{font-weight:700}.oembedall-ljuser img{vertical-align:bottom;border:0;padding-right:1px}.oembedall-stoqembed{border-bottom:1px dotted #999;float:left;overflow:hidden;width:730px;line-height:1;background:#FFF;color:#000;font-family:Arial,Liberation Sans,DejaVu Sans,sans-serif;font-size:80%;text-align:left;margin:0;padding:0}.oembedall-stoqembed a{color:#07C;text-decoration:none;margin:0;padding:0}.oembedall-stoqembed a:hover{text-decoration:underline}.oembedall-stoqembed a:visited{color:#4A6B82}.oembedall-stoqembed h3{font-family:Trebuchet MS,Liberation Sans,DejaVu Sans,sans-serif;font-size:130%;font-weight:700;margin:0;padding:0}.oembedall-stoqembed .oembedall-reputation-score{color:#444;font-size:120%;font-weight:700;margin-right:2px}.oembedall-stoqembed .oembedall-user-info{height:35px;width:185px}.oembedall-stoqembed .oembedall-user-info .oembedall-user-gravatar32{float:left;height:32px;width:32px}.oembedall-stoqembed .oembedall-user-info .oembedall-user-details{float:left;margin-left:5px;overflow:hidden;white-space:nowrap;width:145px}.oembedall-stoqembed .oembedall-question-hyperlink{font-weight:700}.oembedall-stoqembed .oembedall-stats{background:#EEE;margin:0 0 0 7px;padding:4px 7px 6px;width:58px}.oembedall-stoqembed .oembedall-statscontainer{float:left;margin-right:8px;width:86px}.oembedall-stoqembed .oembedall-votes{color:#555;padding:0 0 7px;text-align:center}.oembedall-stoqembed .oembedall-vote-count-post{font-size:240%;color:#808185;display:block;font-weight:700}.oembedall-stoqembed .oembedall-views{color:#999;padding-top:4px;text-align:center}.oembedall-stoqembed .oembedall-status{margin-top:-3px;padding:4px 0;text-align:center;background:#75845C;color:#FFF}.oembedall-stoqembed .oembedall-status strong{color:#FFF;display:block;font-size:140%}.oembedall-stoqembed .oembedall-summary{float:left;width:635px}.oembedall-stoqembed .oembedall-excerpt{line-height:1.2;margin:0;padding:0 0 5px}.oembedall-stoqembed .oembedall-tags{float:left;line-height:18px}.oembedall-stoqembed .oembedall-tags a:hover{text-decoration:none}.oembedall-stoqembed .oembedall-post-tag{background-color:#E0EAF1;border-bottom:1px solid #3E6D8E;border-right:1px solid #7F9FB6;color:#3E6D8E;font-size:90%;line-height:2.4;margin:2px 2px 2px 0;padding:3px 4px;text-decoration:none;white-space:nowrap}.oembedall-stoqembed .oembedall-post-tag:hover{background-color:#3E6D8E;border-bottom:1px solid #37607D;border-right:1px solid #37607D;color:#E0EAF1}.oembedall-stoqembed .oembedall-fr{float:right}.oembedall-stoqembed .oembedall-statsarrow{background-image:url(http://cdn.sstatic.net/stackoverflow/img/sprites.png?v=3);background-repeat:no-repeat;overflow:hidden;background-position:0 -435px;float:right;height:13px;margin-top:12px;width:7px}.oembedall-facebook1{border:1px solid #1A3C6C;padding:0;font:13.34px/1.4 verdana;width:500px}.oembedall-facebook2{background-color:#627add}.oembedall-facebook2 a{color:#e8e8e8;text-decoration:none}.oembedall-facebookBody{background-color:#fff;vertical-align:top;padding:5px}.oembedall-facebookBody .contents{display:inline-block;width:100%}.oembedall-facebookBody div img{float:left;margin-right:5px}div.oembedall-lanyard{-webkit-box-shadow:none;-webkit-transition-delay:0s;-webkit-transition-duration:.4000000059604645s;-webkit-transition-property:width;-webkit-transition-timing-function:cubic-bezier(0.42,0,.58,1);background-attachment:scroll;background-clip:border-box;background-color:transparent;background-image:none;background-origin:padding-box;border-width:0;box-shadow:none;color:#112644;display:block;float:left;font-family:'Trebuchet MS',Trebuchet,sans-serif;font-size:16px;height:253px;line-height:19px;margin:0;max-width:none;min-height:0;outline:#112644 0;overflow-x:visible;overflow-y:visible;padding:0;position:relative;text-align:left;vertical-align:baseline;width:804px}div.oembedall-lanyard .tagline{font-size:1.5em}div.oembedall-lanyard .wrapper{overflow:hidden;clear:both}div.oembedall-lanyard .split{float:left;display:inline}div.oembedall-lanyard .prominent-place .flag:active,div.oembedall-lanyard .prominent-place .flag:focus,div.oembedall-lanyard .prominent-place .flag:hover,div.oembedall-lanyard .prominent-place .flag:link,div.oembedall-lanyard .prominent-place .flag:visited{float:left;display:block;width:48px;height:48px;position:relative;top:-5px;margin-right:10px}div.oembedall-lanyard .place-context{font-size:.889em}div.oembedall-lanyard .prominent-place .sub-place{display:block}div.oembedall-lanyard .prominent-place{font-size:1.125em;line-height:1.1em;font-weight:400}div.oembedall-lanyard .main-date{color:#8CB4E0;font-weight:700;line-height:1.1}div.oembedall-lanyard .first{width:48.57%;margin:0 0 0 2.857%}.mermaid .label{color:#333}.node circle,.node polygon,.node rect{fill:#cde498;stroke:#13540c;stroke-width:1px}.edgePath .path{stroke:green;stroke-width:1.5px}.cluster rect{fill:#cdffb2;rx:40;stroke:#6eaa49;stroke-width:1px}.cluster text{fill:#333}.actor{stroke:#13540c;fill:#cde498}text.actor{fill:#000;stroke:none}.actor-line{stroke:grey}.messageLine0{stroke-width:1.5;stroke-dasharray:"2 2";marker-end:"url(#arrowhead)";stroke:#333}.messageLine1{stroke-width:1.5;stroke-dasharray:"2 2";stroke:#333}#arrowhead{fill:#333}#crosshead path{fill:#333!important;stroke:#333!important}.messageText{fill:#333;stroke:none}.labelBox{stroke:#326932;fill:#cde498}.labelText,.loopText{fill:#000;stroke:none}.loopLine{stroke-width:2;stroke-dasharray:"2 2";marker-end:"url(#arrowhead)";stroke:#326932}.note{stroke:#6eaa49;fill:#fff5ad}.noteText{fill:#000;stroke:none;font-family:'trebuchet ms',verdana,arial;font-size:14px}.section{stroke:none;opacity:.2}.section0,.section2{fill:#6eaa49}.section1,.section3{fill:#fff;opacity:.2}.sectionTitle0,.sectionTitle1,.sectionTitle2,.sectionTitle3{fill:#333}.sectionTitle{text-anchor:start;font-size:11px;text-height:14px}.grid .tick{stroke:lightgrey;opacity:.3;shape-rendering:crispEdges}.grid path{stroke-width:0}.today{fill:none;stroke:red;stroke-width:2px}.task{stroke-width:2}.taskText{text-anchor:middle;font-size:11px}.taskTextOutsideRight{fill:#000;text-anchor:start;font-size:11px}.taskTextOutsideLeft{fill:#000;text-anchor:end;font-size:11px}.taskText0,.taskText1,.taskText2,.taskText3{fill:#fff}.task0,.task1,.task2,.task3{fill:#487e3a;stroke:#13540c}.taskTextOutside0,.taskTextOutside1,.taskTextOutside2,.taskTextOutside3{fill:#000}.active0,.active1,.active2,.active3{fill:#cde498;stroke:#13540c}.activeText0,.activeText1,.activeText2,.activeText3{fill:#000!important}.done0,.done1,.done2,.done3{stroke:grey;fill:lightgrey;stroke-width:2}.doneText0,.doneText1,.doneText2,.doneText3{fill:#000!important}.crit0,.crit1,.crit2,.crit3{stroke:#f88;fill:red;stroke-width:2}.activeCrit0,.activeCrit1,.activeCrit2,.activeCrit3{stroke:#f88;fill:#cde498;stroke-width:2}.doneCrit0,.doneCrit1,.doneCrit2,.doneCrit3{stroke:#f88;fill:lightgrey;stroke-width:2;cursor:pointer;shape-rendering:crispEdges}.activeCritText0,.activeCritText1,.activeCritText2,.activeCritText3,.doneCritText0,.doneCritText1,.doneCritText2,.doneCritText3{fill:#000!important}.titleText{text-anchor:middle;font-size:18px;fill:#000}text{font-family:'trebuchet ms',verdana,arial;font-size:14px}html{height:100%}body{margin:0!important;padding:5px 20px 26px!important;background-color:#fff;font-family:"Lucida Grande","Segoe UI","Apple SD Gothic Neo","Malgun Gothic","Lucida Sans Unicode",Helvetica,Arial,sans-serif;font-size:.9em;overflow-x:hidden;overflow-y:auto}br,h1,h2,h3,h4,h5,h6{clear:both}hr.page{background:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAYAAAAECAYAAACtBE5DAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAyJpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuMC1jMDYwIDYxLjEzNDc3NywgMjAxMC8wMi8xMi0xNzozMjowMCAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvIiB4bWxuczp4bXBNTT0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL21tLyIgeG1sbnM6c3RSZWY9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9zVHlwZS9SZXNvdXJjZVJlZiMiIHhtcDpDcmVhdG9yVG9vbD0iQWRvYmUgUGhvdG9zaG9wIENTNSBNYWNpbnRvc2giIHhtcE1NOkluc3RhbmNlSUQ9InhtcC5paWQ6OENDRjNBN0E2NTZBMTFFMEI3QjRBODM4NzJDMjlGNDgiIHhtcE1NOkRvY3VtZW50SUQ9InhtcC5kaWQ6OENDRjNBN0I2NTZBMTFFMEI3QjRBODM4NzJDMjlGNDgiPiA8eG1wTU06RGVyaXZlZEZyb20gc3RSZWY6aW5zdGFuY2VJRD0ieG1wLmlpZDo4Q0NGM0E3ODY1NkExMUUwQjdCNEE4Mzg3MkMyOUY0OCIgc3RSZWY6ZG9jdW1lbnRJRD0ieG1wLmRpZDo4Q0NGM0E3OTY1NkExMUUwQjdCNEE4Mzg3MkMyOUY0OCIvPiA8L3JkZjpEZXNjcmlwdGlvbj4gPC9yZGY6UkRGPiA8L3g6eG1wbWV0YT4gPD94cGFja2V0IGVuZD0iciI/PqqezsUAAAAfSURBVHjaYmRABcYwBiM2QSA4y4hNEKYDQxAEAAIMAHNGAzhkPOlYAAAAAElFTkSuQmCC) repeat-x;border:0;height:3px;padding:0}hr.underscore{border-top-style:dashed!important}body >:first-child{margin-top:0!important}img.plugin{box-shadow:0 1px 3px rgba(0,0,0,.1);border-radius:3px}iframe{border:0}figure{-webkit-margin-before:0;-webkit-margin-after:0;-webkit-margin-start:0;-webkit-margin-end:0}kbd{border:1px solid #aaa;-moz-border-radius:2px;-webkit-border-radius:2px;border-radius:2px;-moz-box-shadow:1px 2px 2px #ddd;-webkit-box-shadow:1px 2px 2px #ddd;box-shadow:1px 2px 2px #ddd;background-color:#f9f9f9;background-image:-moz-linear-gradient(top,#eee,#f9f9f9,#eee);background-image:-o-linear-gradient(top,#eee,#f9f9f9,#eee);background-image:-webkit-linear-gradient(top,#eee,#f9f9f9,#eee);background-image:linear-gradient(top,#eee,#f9f9f9,#eee);padding:1px 3px;font-family:inherit;font-size:.85em}.oembeded .oembed_photo{display:inline-block}img[data-echo]{margin:25px 0;width:100px;height:100px;background:url(../img/ajax.gif) center center no-repeat #fff}.spinner{display:inline-block;width:10px;height:10px;margin-bottom:-.1em;border:2px solid rgba(0,0,0,.5);border-top-color:transparent;border-radius:100%;-webkit-animation:spin 1s infinite linear;animation:spin 1s infinite linear}.spinner:after{content:'';display:block;width:0;height:0;position:absolute;top:-6px;left:0;border:4px solid transparent;border-bottom-color:rgba(0,0,0,.5);-webkit-transform:rotate(45deg);transform:rotate(45deg)}@-webkit-keyframes spin{to{-webkit-transform:rotate(360deg)}}@keyframes spin{to{transform:rotate(360deg)}}p.toc{margin:0!important}p.toc ul{padding-left:10px}p.toc>ul{padding:10px;margin:0 10px;display:inline-block;border:1px solid #ededed;border-radius:5px}p.toc li,p.toc ul{list-style-type:none}p.toc li{width:100%;padding:0;overflow:hidden}p.toc li a::after{content:"."}p.toc li a:before{content:"• "}p.toc h5{text-transform:uppercase}p.toc .title{float:left;padding-right:3px}p.toc .number{margin:0;float:right;padding-left:3px;background:#fff;display:none}input.task-list-item{margin-left:-1.62em}.markdown{font-family:"Hiragino Sans GB","Microsoft YaHei",STHeiti,SimSun,"Lucida Grande","Lucida Sans Unicode","Lucida Sans",'Segoe UI',AppleSDGothicNeo-Medium,'Malgun Gothic',Verdana,Tahoma,sans-serif;padding:20px}.markdown a{text-decoration:none;vertical-align:baseline}.markdown a:hover{text-decoration:underline}.markdown h1{font-size:2.2em;font-weight:700;margin:1.5em 0 1em}.markdown h2{font-size:1.8em;font-weight:700;margin:1.275em 0 .85em}.markdown h3{font-size:1.6em;font-weight:700;margin:1.125em 0 .75em}.markdown h4{font-size:1.4em;font-weight:700;margin:.99em 0 .66em}.markdown h5{font-size:1.2em;font-weight:700;margin:.855em 0 .57em}.markdown h6{font-size:1em;font-weight:700;margin:.75em 0 .5em}.markdown h1+p,.markdown h1:first-child,.markdown h2+p,.markdown h2:first-child,.markdown h3+p,.markdown h3:first-child,.markdown h4+p,.markdown h4:first-child,.markdown h5+p,.markdown h5:first-child,.markdown h6+p,.markdown h6:first-child{margin-top:0}.markdown hr{border:1px solid #ccc}.markdown p{margin:1em 0;word-wrap:break-word}.markdown ol{list-style-type:decimal}.markdown li{display:list-item;line-height:1.4em}.markdown blockquote{margin:1em 20px}.markdown blockquote>:first-child{margin-top:0}.markdown blockquote>:last-child{margin-bottom:0}.markdown blockquote cite:before{content:'\2014 \00A0'}.markdown .code{border-radius:3px;word-wrap:break-word}.markdown pre{border-radius:3px;word-wrap:break-word;border:1px solid #ccc;overflow:auto;padding:.5em}.markdown pre code{border:0;display:block}.markdown pre>code{font-family:Consolas,Inconsolata,Courier,monospace;font-weight:700;white-space:pre;margin:0}.markdown code{border-radius:3px;word-wrap:break-word;border:1px solid #ccc;padding:0 5px;margin:0 2px}.markdown img{max-width:100%}.markdown mark{color:#000;background-color:#fcf8e3}.markdown table{padding:0;border-collapse:collapse;border-spacing:0;margin-bottom:16px}.markdown table tr td,.markdown table tr th{border:1px solid #ccc;margin:0;padding:6px 13px}.markdown table tr th{font-weight:700}.markdown table tr th>:first-child{margin-top:0}.markdown table tr th>:last-child{margin-bottom:0}.markdown table tr td>:first-child{margin-top:0}.markdown table tr td>:last-child{margin-bottom:0}@import url(http://fonts.googleapis.com/css?family=Roboto+Condensed:300italic,400italic,700italic,400,300,700);.haroopad{padding:20px;color:#222;font-size:15px;font-family:"Roboto Condensed",Tauri,"Hiragino Sans GB","Microsoft YaHei",STHeiti,SimSun,"Lucida Grande","Lucida Sans Unicode","Lucida Sans",'Segoe UI',AppleSDGothicNeo-Medium,'Malgun Gothic',Verdana,Tahoma,sans-serif;background:#fff;line-height:1.6;-webkit-font-smoothing:antialiased}.haroopad a{color:#3269a0}.haroopad a:hover{color:#4183c4}.haroopad h2{border-bottom:1px solid #e6e6e6}.haroopad h6{color:#777}.haroopad hr{border:1px solid #e6e6e6}.haroopad blockquote>code,.haroopad h1>code,.haroopad h2>code,.haroopad h3>code,.haroopad h4>code,.haroopad h5>code,.haroopad h6>code,.haroopad li>code,.haroopad p>code,.haroopad td>code{font-family:Consolas,"Liberation Mono",Menlo,Courier,monospace;font-size:85%;background-color:rgba(0,0,0,.02);padding:.2em .5em;border:1px solid #efefef}.haroopad pre>code{font-size:1em;letter-spacing:-1px;font-weight:700}.haroopad blockquote{border-left:4px solid #e6e6e6;padding:0 15px;color:#777}.haroopad table{background-color:#fafafa}.haroopad table tr td,.haroopad table tr th{border:1px solid #e6e6e6}.haroopad table tr:nth-child(2n){background-color:#f2f2f2}.hljs{display:block;overflow-x:auto;padding:.5em;background:#fdf6e3;color:#657b83;-webkit-text-size-adjust:none}.diff .hljs-header,.hljs-comment,.hljs-doctype,.hljs-javadoc,.hljs-pi,.lisp .hljs-string{color:#93a1a1}.css .hljs-tag,.hljs-addition,.hljs-keyword,.hljs-request,.hljs-status,.hljs-winutils,.method,.nginx .hljs-title{color:#859900}.hljs-command,.hljs-dartdoc,.hljs-hexcolor,.hljs-link_url,.hljs-number,.hljs-phpdoc,.hljs-regexp,.hljs-rules .hljs-value,.hljs-string,.hljs-tag .hljs-value,.tex .hljs-formula{color:#2aa198}.css .hljs-function,.hljs-built_in,.hljs-chunk,.hljs-decorator,.hljs-id,.hljs-identifier,.hljs-localvars,.hljs-title,.vhdl .hljs-literal{color:#268bd2}.hljs-attribute,.hljs-class .hljs-title,.hljs-constant,.hljs-link_reference,.hljs-parent,.hljs-type,.hljs-variable,.lisp .hljs-body,.smalltalk .hljs-number{color:#b58900}.css .hljs-pseudo,.diff .hljs-change,.hljs-attr_selector,.hljs-cdata,.hljs-header,.hljs-pragma,.hljs-preprocessor,.hljs-preprocessor .hljs-keyword,.hljs-shebang,.hljs-special,.hljs-subst,.hljs-symbol,.hljs-symbol .hljs-string{color:#cb4b16}.hljs-deletion,.hljs-important{color:#dc322f}.hljs-link_label{color:#6c71c4}.tex .hljs-formula{background:#eee8d5}.MathJax_Hover_Frame{border-radius:.25em;-webkit-border-radius:.25em;-moz-border-radius:.25em;-khtml-border-radius:.25em;box-shadow:0 0 15px #83A;-webkit-box-shadow:0 0 15px #83A;-moz-box-shadow:0 0 15px #83A;-khtml-box-shadow:0 0 15px #83A;border:1px solid #A6D!important;display:inline-block;position:absolute}.MathJax_Hover_Arrow{position:absolute;width:15px;height:11px;cursor:pointer}#MathJax_About{position:fixed;left:50%;width:auto;text-align:center;border:3px outset;padding:1em 2em;background-color:#DDD;color:#000;cursor:default;font-family:message-box;font-size:120%;font-style:normal;text-indent:0;text-transform:none;line-height:normal;letter-spacing:normal;word-spacing:normal;word-wrap:normal;white-space:nowrap;float:none;z-index:201;border-radius:15px;-webkit-border-radius:15px;-moz-border-radius:15px;-khtml-border-radius:15px;box-shadow:0 10px 20px gray;-webkit-box-shadow:0 10px 20px gray;-moz-box-shadow:0 10px 20px gray;-khtml-box-shadow:0 10px 20px gray;filter:progid:DXImageTransform.Microsoft.dropshadow(OffX=2, OffY=2, Color='gray', Positive='true')}.MathJax_Menu{position:absolute;background-color:#fff;color:#000;width:auto;padding:2px;border:1px solid #CCC;margin:0;cursor:default;font:menu;text-align:left;text-indent:0;text-transform:none;line-height:normal;letter-spacing:normal;word-spacing:normal;word-wrap:normal;white-space:nowrap;float:none;z-index:201;box-shadow:0 10px 20px gray;-webkit-box-shadow:0 10px 20px gray;-moz-box-shadow:0 10px 20px gray;-khtml-box-shadow:0 10px 20px gray;filter:progid:DXImageTransform.Microsoft.dropshadow(OffX=2, OffY=2, Color='gray', Positive='true')}.MathJax_MenuItem{padding:2px 2em;background:0 0}.MathJax_MenuArrow{position:absolute;right:.5em;color:#666}.MathJax_MenuActive .MathJax_MenuArrow{color:#fff}.MathJax_MenuArrow.RTL{left:.5em;right:auto}.MathJax_MenuCheck{position:absolute;left:.7em}.MathJax_MenuCheck.RTL{right:.7em;left:auto}.MathJax_MenuRadioCheck{position:absolute;left:1em}.MathJax_MenuRadioCheck.RTL{right:1em;left:auto}.MathJax_MenuLabel{padding:2px 2em 4px 1.33em;font-style:italic}.MathJax_MenuRule{border-top:1px solid #CCC;margin:4px 1px 0}.MathJax_MenuDisabled{color:GrayText}.MathJax_MenuActive{background-color:Highlight;color:HighlightText}.MathJax_Menu_Close{position:absolute;width:31px;height:31px;top:-15px;left:-15px}#MathJax_Zoom{position:absolute;background-color:#F0F0F0;overflow:auto;display:block;z-index:301;padding:.5em;border:1px solid #000;margin:0;font-weight:400;font-style:normal;text-align:left;text-indent:0;text-transform:none;line-height:normal;letter-spacing:normal;word-spacing:normal;word-wrap:normal;white-space:nowrap;float:none;box-shadow:5px 5px 15px #AAA;-webkit-box-shadow:5px 5px 15px #AAA;-moz-box-shadow:5px 5px 15px #AAA;-khtml-box-shadow:5px 5px 15px #AAA;filter:progid:DXImageTransform.Microsoft.dropshadow(OffX=2, OffY=2, Color='gray', Positive='true')}#MathJax_ZoomOverlay{position:absolute;left:0;top:0;z-index:300;display:inline-block;width:100%;height:100%;border:0;padding:0;margin:0;background-color:#fff;opacity:0;filter:alpha(opacity=0)}#MathJax_ZoomFrame{position:relative;display:inline-block;height:0;width:0}#MathJax_ZoomEventTrap{position:absolute;left:0;top:0;z-index:302;display:inline-block;border:0;padding:0;margin:0;background-color:#fff;opacity:0;filter:alpha(opacity=0)}.MathJax_Preview{color:#888}#MathJax_Message{position:fixed;left:1px;bottom:2px;background-color:#E6E6E6;border:1px solid #959595;margin:0;padding:2px 8px;z-index:102;color:#000;font-size:80%;width:auto;white-space:nowrap}#MathJax_MSIE_Frame{position:absolute;top:0;left:0;width:0;z-index:101;border:0;margin:0;padding:0}.MathJax_Error{color:#C00;font-style:italic}footer{position:fixed;font-size:.8em;text-align:right;bottom:0;margin-left:-25px;height:20px;width:100%}</style>
</head>
<body class="markdown haroopad">
<h1 id="prague-openstreetsmap-project"><a name="prague-openstreetsmap-project" href="#prague-openstreetsmap-project"></a>Prague OpenStreetsMap Project</h1><p class="toc" style="undefined"></p><ul>
<li><ul>
<li><span class="title">
<a href="#map-area" title="Map Area">Map Area</a>
</span>
<!--span class="number">
0
</span-->
</li>
<li><span class="title">
<a href="#data-problems:-audit-address-information" title="Data Problems: Audit Address Information">Data Problems: Audit Address Information</a>
</span>
<!--span class="number">
1
</span-->
<ul>
<li><span class="title">
<a href="#audit-house-numbers" title="Audit House Numbers">Audit House Numbers</a>
</span>
<!--span class="number">
2
</span-->
</li>
<li><span class="title">
<a href="#audit-street-names" title="Audit Street Names">Audit Street Names</a>
</span>
<!--span class="number">
3
</span-->
</li>
<li><span class="title">
<a href="#audit-postcodes" title="Audit Postcodes">Audit Postcodes</a>
</span>
<!--span class="number">
4
</span-->
</li>
</ul>
</li>
<li><span class="title">
<a href="#data-exploration" title="Data Exploration">Data Exploration</a>
</span>
<!--span class="number">
5
</span-->
<ul>
<li><span class="title">
<a href="#overview-of-dataset-statistics" title="Overview of Dataset Statistics">Overview of Dataset Statistics</a>
</span>
<!--span class="number">
6
</span-->
</li>
<li><span class="title">
<a href="#find-vegetarian-restaurants" title="Find Vegetarian Restaurants">Find Vegetarian Restaurants</a>
</span>
<!--span class="number">
7
</span-->
</li>
<li><span class="title">
<a href="#find-playgrounds" title="Find Playgrounds">Find Playgrounds</a>
</span>
<!--span class="number">
8
</span-->
</li>
<li><span class="title">
<a href="#district-statistics" title="District Statistics">District Statistics</a>
</span>
<!--span class="number">
9
</span-->
</li>
</ul>
</li>
<li><span class="title">
<a href="#conclusion" title="Conclusion">Conclusion</a>
</span>
<!--span class="number">
10
</span-->
</li>
</ul>
</li>

</ul>
<p></p><h2 id="map-area"><a name="map-area" href="#map-area"></a>Map Area</h2><p>Prague, Czech Republic.</p><p><a href="https://mapzen.com/data/metro-extracts/">https://mapzen.com/data/metro-extracts/</a> </p><p>In this project I am considering OpenStreetsMap data for Prague, where I have been living for four years.</p><p>OSM XML file for the whole area was downloaded via Map Zen interface. Small sample data is provided in ‘\data\sample.osm’. Some intermediate data files were also used for analysis and were downloaded via Overpass API.</p><h2 id="data-problems:-audit-address-information"><a name="data-problems:-audit-address-information" href="#data-problems:-audit-address-information"></a>Data Problems: Audit Address Information</h2><p>House numbering system in Czech Republic is quite complicated, two numbering systems are used concurrently.<br>The basic house number is the “old” or “descriptive number” . The descriptive number is unique within the municipal part (a village, a quarter, mostly for one cadastral area) or within a whole small municipality. In most cities there are used also the “new” or “orientation numbers”. The orientation numbers are arranged sequentially within the street or square. If the building is on a corner or has two sides, it can have two or more orientation numbers, one for each of the adjacent streets or squares. Typical house number in Prague contains two numbers, which are written divided by slash, e.g. 593/5.</p><p>More detailed information can be found here:<br><a href="https://wiki.openstreetmap.org/wiki/Template:CzechAddress">https://wiki.openstreetmap.org/wiki/Template:CzechAddress</a>,<br><a href="https://wiki.openstreetmap.org/wiki/Cs:WikiProject_Czech_Republic/Address_system">https://wiki.openstreetmap.org/wiki/Cs:WikiProject_Czech_Republic/Address_system</a>,<br><a href="https://en.wikipedia.org/wiki/House_numbering">https://en.wikipedia.org/wiki/House_numbering</a>.</p><p>It comes as no surprise that a lot of problems and errors were detected in address information.</p><p>Three main audit procedures related to address data were considered:</p><ul>
<li>Audit of house numbers</li><li>Audit of street names</li><li>Audit of postcodes</li></ul><h3 id="audit-house-numbers"><a name="audit-house-numbers" href="#audit-house-numbers"></a>Audit House Numbers</h3><p>Below you can find some examples of problematic data.</p><p>In the next example two different addresses were mixed for the same element. This address is not valid. </p><table>
<thead>
<tr>
<th>id</th>
<th>key</th>
<th>value</th>
<th>type</th>
</tr>
</thead>
<tbody>
<tr>
<td>296510460</td>
<td>conscriptionnumber</td>
<td>134;1301</td>
<td>addr</td>
</tr>
<tr>
<td>296510460</td>
<td>housenumber</td>
<td>134/16;1301/4</td>
<td>addr</td>
</tr>
<tr>
<td>296510460</td>
<td>postcode</td>
<td>14000</td>
<td>addr</td>
</tr>
<tr>
<td>296510460</td>
<td>street</td>
<td>Na Strži;Panuškova</td>
<td>addr</td>
</tr>
<tr>
<td>296510460</td>
<td>streetnumber</td>
<td>16;4</td>
<td>addr</td>
</tr>
</tbody>
</table><p>In this example housenumber is not complete and does not include conscriptionnumber, complete housenumber here will be 1008/22</p><table>
<thead>
<tr>
<th>id</th>
<th>key</th>
<th>value</th>
<th>type</th>
</tr>
</thead>
<tbody>
<tr>
<td>296550228</td>
<td>conscriptionnumber</td>
<td>1008</td>
<td>addr</td>
</tr>
<tr>
<td>296550228</td>
<td>housenumber</td>
<td>22</td>
<td>addr</td>
</tr>
<tr>
<td>296550228</td>
<td>postcode</td>
<td>11000</td>
<td>addr</td>
</tr>
<tr>
<td>296550228</td>
<td>street</td>
<td>Hybernská</td>
<td>addr</td>
</tr>
<tr>
<td>296550228</td>
<td>streetnumber</td>
<td>22</td>
<td>addr</td>
</tr>
</tbody>
</table><p>The following checkings were implemented:</p><ul>
<li>Validity<ul>
<li>Both conscriptionnumber and provisionalnumber are given</li><li>Not valid type of housenumber</li><li>Not valid type of streetnumber</li><li>Not valid type of conscriptionnumber or provisionalnumber</li></ul>
</li><li>Completeness<ul>
<li>Missed housenumber</li><li>Missed first number (conscriptionnumber | provisionalnumber),streetnumber or both</li><li>Missed first number (conscriptionnumber | provisionalnumber) or streetnumber in housenumber</li></ul>
</li><li>Consistency<ul>
<li>Composite hsnumber is not consistent with first number (conscriptionnumber | provisionalnumber) and streetnumber</li><li>One-number hsnumber is not consistent with first number (conscriptionnumber | provisionalnumber) or streetnumber</li></ul>
</li></ul><p>Audit report for the whole data set:</p><pre><code class="sh" data-origin="<pre><code class=&quot;sh&quot;>Audit House Numbers
******************************
{'Both cnsnumber and prvnumber are given': 1,
 'Incomplete hsnumber': 11,
 'Inconsistent hsnumber': 13,
 'Missed fstnumber, streetnumber or both': 428,
 'Missed hsnumber': 73,
 'Missed streetnumber or fstnumber in hsnumber': 12,
 'Not valid type of housenumber': 55}
Estimated time:  0h 2min 48sec 864mls
</code></pre>">Audit House Numbers
******************************
{'Both cnsnumber and prvnumber are given': 1,
 'Incomplete hsnumber': 11,
 'Inconsistent hsnumber': 13,
 'Missed fstnumber, streetnumber or both': 428,
 'Missed hsnumber': 73,
 'Missed streetnumber or fstnumber in hsnumber': 12,
 'Not valid type of housenumber': 55}
Estimated time:  0h 2min 48sec 864mls
</code></pre><p>Suggested corrections:</p><ul>
<li>Fix Completeness problems<ul>
<li>Complete housenumber<br>Complete housenumber from given first number (conscriptionnumber | provisionalnumber) and streetnumber</li><li>Add first number (conscriptionnumber | provisionalnumber) and streetnumber if they are missed</li></ul>
</li></ul><h3 id="audit-street-names"><a name="audit-street-names" href="#audit-street-names"></a>Audit Street Names</h3><p>Most street names contain special Czech symbols, for example: Francouzská, Na Louži.<br>Sometimes people use only Latin letters in Czech text, for example if they do not have access to Czech keyboard. In this situation above examples will become Francouzska, Na Louzi.</p><p>The following is an examples of mistyped street name from the dataset:</p><pre><code class="sh" data-origin="<pre><code class=&quot;sh&quot;>Nitranská, Nitranska
Národní, Narodni
</code></pre>">Nitranská, Nitranska
Národní, Narodni
</code></pre><p>First street name in the pair is the right one and the second name is mistyped.</p><p>In order to find such cases a list of common mistypes were introduced:</p><pre class="python hljs"><code class="python" data-origin="<pre><code class=&quot;python&quot;>#openstrmap.helper:
cz_subst = {u'á':u'a', u'č':u'c', u'ď':u'd', u'é':u'e', u'ě':u'e', 
             u'í':u'i', u'ň':u'n', u'ó':u'o', u'ř':u'r', u'š':u's', 
              u'ť':u't', u'ů':u'u', u'ý':u'y', u'ž':u'z'}
</code></pre>"><span class="hljs-comment">#openstrmap.helper:</span>
cz_subst = {<span class="hljs-string">u'á'</span>:<span class="hljs-string">u'a'</span>, <span class="hljs-string">u'č'</span>:<span class="hljs-string">u'c'</span>, <span class="hljs-string">u'ď'</span>:<span class="hljs-string">u'd'</span>, <span class="hljs-string">u'é'</span>:<span class="hljs-string">u'e'</span>, <span class="hljs-string">u'ě'</span>:<span class="hljs-string">u'e'</span>, 
             <span class="hljs-string">u'í'</span>:<span class="hljs-string">u'i'</span>, <span class="hljs-string">u'ň'</span>:<span class="hljs-string">u'n'</span>, <span class="hljs-string">u'ó'</span>:<span class="hljs-string">u'o'</span>, <span class="hljs-string">u'ř'</span>:<span class="hljs-string">u'r'</span>, <span class="hljs-string">u'š'</span>:<span class="hljs-string">u's'</span>, 
              <span class="hljs-string">u'ť'</span>:<span class="hljs-string">u't'</span>, <span class="hljs-string">u'ů'</span>:<span class="hljs-string">u'u'</span>, <span class="hljs-string">u'ý'</span>:<span class="hljs-string">u'y'</span>, <span class="hljs-string">u'ž'</span>:<span class="hljs-string">u'z'</span>}
</code></pre><p>The following function compare two street names and defines if these names can be the same after correction of some common mistypes. In other words it checks if Latin versions of two street names are equal while not-Latin versions are not.</p><pre class="python hljs"><code class="python" data-origin="<pre><code class=&quot;python&quot;>import openstrmap.helper as hlp

def is_equalmstp(strname1, strname2):
    trf = lambda s: hlp.cz_subst.get(s) if hlp.cz_subst.get(s) is not None else s
    if (strname1 != strname2) and ([trf(s) for s in strname1] == [trf(s) for s in strname2]):
        return True
    else:
        return False
</code></pre>"><span class="hljs-keyword">import</span> openstrmap.helper <span class="hljs-keyword">as</span> hlp

<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">is_equalmstp</span><span class="hljs-params">(strname1, strname2)</span>:</span>
    trf = <span class="hljs-keyword">lambda</span> s: hlp.cz_subst.get(s) <span class="hljs-keyword">if</span> hlp.cz_subst.get(s) <span class="hljs-keyword">is</span> <span class="hljs-keyword">not</span> <span class="hljs-keyword">None</span> <span class="hljs-keyword">else</span> s
    <span class="hljs-keyword">if</span> (strname1 != strname2) <span class="hljs-keyword">and</span> ([trf(s) <span class="hljs-keyword">for</span> s <span class="hljs-keyword">in</span> strname1] == [trf(s) <span class="hljs-keyword">for</span> s <span class="hljs-keyword">in</span> strname2]):
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">True</span>
    <span class="hljs-keyword">else</span>:
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">False</span>
</code></pre><p>All pairs where one street name were probably mistyped were identified. Actually there are examples of street names which can be considered as mistyped according to this logic , but in reality are correct names. As additional check I used postcodes. If two different street names have the same Latin spelling and the same postcodes, then probably one street name was mistyped. </p><p>We will fix these errors and use the right version of a street name. We assume that the right version is the one, which contain more “special Czech symbols”. During the audit procedure all these candidates are logged in a separate file, so one can manually check and edit this list before running correction procedures.</p><p>Another problem related to street names - different case letters, some examples are presented below:</p><pre><code class="sh" data-origin="<pre><code class=&quot;sh&quot;>náměstí Míru, Náměstí Míru
K vodě, K Vodě
</code></pre>">náměstí Míru, Náměstí Míru
K vodě, K Vodě
</code></pre><p>It is quite common especially for street names which consist of more than one word. We will assume that all words in a street name should start with upper case letters and make corresponding corrections in the data;</p><p>Audit report for the whole data set:</p><pre><code class="sh" data-origin="<pre><code class=&quot;sh&quot;>Audit Street Names
******************************
{'Mistyped street names': 8, 'Problem chars in street name': 9}
Estimated time:  0h 59min 15sec 378mls
</code></pre>">Audit Street Names
******************************
{'Mistyped street names': 8, 'Problem chars in street name': 9}
Estimated time:  0h 59min 15sec 378mls
</code></pre><h3 id="audit-postcodes"><a name="audit-postcodes" href="#audit-postcodes"></a>Audit Postcodes</h3><p>All Prague postcodes have 5 digits and start from 1, second digit defines district of the city.<br>For example address with postcode 12000 is in the city district “Prague 2”. However there<br> are some non-Prague postcodes, which correspond to villages close to the city.</p><p>Examples of invalid postcodes</p><pre><code class="sh" data-origin="<pre><code class=&quot;sh&quot;> CZ - 130 00
 12000 Praha 7
 1051
</code></pre>"> CZ - 130 00
 12000 Praha 7
 1051
</code></pre><p>Postcode validity is checked using the following simple regular expression:</p><pre class="python hljs"><code class="python" data-origin="<pre><code class=&quot;python&quot;>patt = r'^[1-9]\d{4}

<footer style="position:fixed; font-size:.8em; text-align:right; bottom:0px; margin-left:-25px; height:20px; width:100%;">generated by <a href="http://pad.haroopress.com" target="_blank">haroopad</a></footer>
</body>
</html>

</code></pre>">patt = <span class="hljs-string">r'^[1-9]\d{4}

@@footer
</body>
</html>
</span>
</code></pre><p>In some cases it is possible to extract valid postal code from given invalid data. For example we can extract postal code ‘13000’ from ‘CZ - 130 00’ and ‘12000’ from ‘12000 Praha 7’.</p><p>This extraction procedure was accomplished with the following regular expression:</p><pre class="python hljs"><code class="python" data-origin="<pre><code class=&quot;python&quot;>patt = r'^(?:.*\D)?([1-9](?:\s?\d\s?){4})(?:\D.*)?'
</code></pre>">patt = <span class="hljs-string">r'^(?:.*\D)?([1-9](?:\s?\d\s?){4})(?:\D.*)?'</span>
</code></pre><p>Another encountered issue is spaces in postcodes. Since most postcodes do not contain any spaces,  all valid postcodes were standardized to the format without spaces.</p><pre><code data-origin="<pre><code>
Audit report for the whole data set:

```sh
Audit Postcodes
******************************
{'Wrong type for post code': 7}
</code></pre>">
Audit report for the whole data set:

```sh
Audit Postcodes
******************************
{'Wrong type for post code': 7}
</code></pre><h2 id="data-exploration"><a name="data-exploration" href="#data-exploration"></a>Data Exploration</h2><p>In this section data is explored with the help of SQL queries. All SQL queries are stored in separate .sql files in /sql/scripts. Queries are run with Python DB API, results are stored in corresponding csv files in /sql/query_results.</p><h3 id="overview-of-dataset-statistics"><a name="overview-of-dataset-statistics" href="#overview-of-dataset-statistics"></a>Overview of Dataset Statistics</h3><p>The size of the uncompressed XML file is 1.67 GB.</p><p>Number of nodes</p><pre class="sql hljs"><code class="sql" data-origin="<pre><code class=&quot;sql&quot;>select count(*) from nodes

&amp;gt;&amp;gt; 7870968
</code></pre>"><span class="hljs-operator"><span class="hljs-keyword">select</span> <span class="hljs-keyword">count</span>(*) <span class="hljs-keyword">from</span> nodes

&gt;&gt; <span class="hljs-number">7870968</span>
</span></code></pre><p>Number of ways</p><pre class="sql hljs"><code class="sql" data-origin="<pre><code class=&quot;sql&quot;>select count(*) from ways

&amp;gt;&amp;gt;899272
</code></pre>"><span class="hljs-operator"><span class="hljs-keyword">select</span> <span class="hljs-keyword">count</span>(*) <span class="hljs-keyword">from</span> ways

&gt;&gt;<span class="hljs-number">899272</span>
</span></code></pre><p>Number of unique users</p><pre class="sql hljs"><code class="sql" data-origin="<pre><code class=&quot;sql&quot;>select count(distinct uid) from
(select uid from nodes
union
select uid from ways)

&amp;gt;&amp;gt;2362
</code></pre>"><span class="hljs-operator"><span class="hljs-keyword">select</span> <span class="hljs-keyword">count</span>(<span class="hljs-keyword">distinct</span> uid) <span class="hljs-keyword">from</span>
(<span class="hljs-keyword">select</span> uid <span class="hljs-keyword">from</span> nodes
<span class="hljs-keyword">union</span>
<span class="hljs-keyword">select</span> uid <span class="hljs-keyword">from</span> ways)

&gt;&gt;<span class="hljs-number">2362</span>
</span></code></pre><h3 id="find-vegetarian-restaurants"><a name="find-vegetarian-restaurants" href="#find-vegetarian-restaurants"></a>Find Vegetarian Restaurants</h3><p>I like vegetarian restaurants and I would like to know which restaurants are the closest to my house location. In order to get this information I need a function which calculates distance between two points, defined by pairs of latitudes and longitudes. SQLite does not have a stored function/stored procedure language, as an alternative python DB API can be used.</p><p>Python package sqlite3 provides function ‘create_function’, which creates a user-defined function that can later be used from within SQL statements. </p><pre class="python hljs"><code class="python" data-origin="<pre><code class=&quot;python&quot;>    conn = sqlite3.connect(dbfilepath)
    conn.create_function(&quot;distance&quot;, 4, hvrs_dist)
</code></pre>">    conn = sqlite3.connect(dbfilepath)
    conn.create_function(<span class="hljs-string">"distance"</span>, <span class="hljs-number">4</span>, hvrs_dist)
</code></pre><p>Function hvrs_dist uses external python package haversine and is defined as follows:</p><pre class="python hljs"><code class="python" data-origin="<pre><code class=&quot;python&quot;>from haversine import haversine

def hvrs_dist(lat1, lon1, lat2, lon2):
    return haversine((lat1, lon1), (lat2, lon2))
</code></pre>"><span class="hljs-keyword">from</span> haversine <span class="hljs-keyword">import</span> haversine

<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">hvrs_dist</span><span class="hljs-params">(lat1, lon1, lat2, lon2)</span>:</span>
    <span class="hljs-keyword">return</span> haversine((lat1, lon1), (lat2, lon2))
</code></pre><p>The following SQL query template can be used to selects a fixed number(LIMIT_THRSH) of vegetarian restaurants, which are the closest to specified location (TRG_LAT, TRG_LON):</p><pre class="sql hljs"><code class="sql" data-origin="<pre><code class=&quot;sql&quot;>SELECT N1.id,
       N1.value AS rest_name,
       N2.value AS addr_street,
       N3.value AS addr_hsnumber,
       N4.value AS rest_phone,
       distance(B.lat, B.lon, TRG_LAT, TRG_LON) AS dist
FROM nodes_tags N1
INNER JOIN
  (SELECT n.id,
          n.lat,
          n.lon
   FROM nodes n
   INNER JOIN nodes_tags nt ON (n.id = nt.id)
   WHERE nt.key = &quot;cuisine&quot;
     AND (nt.value LIKE &quot;%vegetarian%&quot;
          OR nt.value LIKE &quot;%vegan_food%&quot;
          OR nt.value LIKE &quot;%vegan%&quot;) ) B ON (N1.id = B.id)
LEFT JOIN nodes_tags N2 ON (N1.id = N2.id
                            AND N2.key=&quot;street&quot;)
LEFT JOIN nodes_tags N3 ON (N1.id = N3.id
                            AND N3.key=&quot;housenumber&quot;)
LEFT JOIN nodes_tags N4 ON (N1.id = N4.id
                            AND N4.key=&quot;phone&quot;)
WHERE N1.key = &quot;name&quot;
ORDER BY dist LIMIT LIMIT_THRSH
</code></pre>"><span class="hljs-operator"><span class="hljs-keyword">SELECT</span> N1.id,
       N1.<span class="hljs-keyword">value</span> <span class="hljs-keyword">AS</span> rest_name,
       N2.<span class="hljs-keyword">value</span> <span class="hljs-keyword">AS</span> addr_street,
       N3.<span class="hljs-keyword">value</span> <span class="hljs-keyword">AS</span> addr_hsnumber,
       N4.<span class="hljs-keyword">value</span> <span class="hljs-keyword">AS</span> rest_phone,
       distance(B.lat, B.lon, TRG_LAT, TRG_LON) <span class="hljs-keyword">AS</span> dist
<span class="hljs-keyword">FROM</span> nodes_tags N1
<span class="hljs-keyword">INNER</span> <span class="hljs-keyword">JOIN</span>
  (<span class="hljs-keyword">SELECT</span> n.id,
          n.lat,
          n.lon
   <span class="hljs-keyword">FROM</span> nodes n
   <span class="hljs-keyword">INNER</span> <span class="hljs-keyword">JOIN</span> nodes_tags nt <span class="hljs-keyword">ON</span> (n.id = nt.id)
   <span class="hljs-keyword">WHERE</span> nt.<span class="hljs-keyword">key</span> = <span class="hljs-string">"cuisine"</span>
     <span class="hljs-keyword">AND</span> (nt.<span class="hljs-keyword">value</span> <span class="hljs-keyword">LIKE</span> <span class="hljs-string">"%vegetarian%"</span>
          <span class="hljs-keyword">OR</span> nt.<span class="hljs-keyword">value</span> <span class="hljs-keyword">LIKE</span> <span class="hljs-string">"%vegan_food%"</span>
          <span class="hljs-keyword">OR</span> nt.<span class="hljs-keyword">value</span> <span class="hljs-keyword">LIKE</span> <span class="hljs-string">"%vegan%"</span>) ) B <span class="hljs-keyword">ON</span> (N1.id = B.id)
<span class="hljs-keyword">LEFT</span> <span class="hljs-keyword">JOIN</span> nodes_tags N2 <span class="hljs-keyword">ON</span> (N1.id = N2.id
                            <span class="hljs-keyword">AND</span> N2.<span class="hljs-keyword">key</span>=<span class="hljs-string">"street"</span>)
<span class="hljs-keyword">LEFT</span> <span class="hljs-keyword">JOIN</span> nodes_tags N3 <span class="hljs-keyword">ON</span> (N1.id = N3.id
                            <span class="hljs-keyword">AND</span> N3.<span class="hljs-keyword">key</span>=<span class="hljs-string">"housenumber"</span>)
<span class="hljs-keyword">LEFT</span> <span class="hljs-keyword">JOIN</span> nodes_tags N4 <span class="hljs-keyword">ON</span> (N1.id = N4.id
                            <span class="hljs-keyword">AND</span> N4.<span class="hljs-keyword">key</span>=<span class="hljs-string">"phone"</span>)
<span class="hljs-keyword">WHERE</span> N1.<span class="hljs-keyword">key</span> = <span class="hljs-string">"name"</span>
<span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> dist <span class="hljs-keyword">LIMIT</span> LIMIT_THRSH
</span></code></pre><p>Example of 10 vegetarian restaurants closest to the metro station Náměstí Míru (LIMIT_THRSH=10, TRG_LAT=50.075104, TRG_LON=14.437783):</p><table>
<thead>
<tr>
<th>id</th>
<th>restaurant</th>
<th>street</th>
<th>hsnumber</th>
<th>phone</th>
<th>dist (km)</th>
</tr>
</thead>
<tbody>
<tr>
<td>3725294145</td>
<td>Loving Hut</td>
<td>Londýnská</td>
<td>35</td>
<td>420 222 515 006</td>
<td>0.348618262955</td>
</tr>
<tr>
<td>3722700025</td>
<td>Etnosvět</td>
<td>Legerova</td>
<td>40</td>
<td>+420 226203880</td>
<td>0.554828543945</td>
</tr>
<tr>
<td>3725310177</td>
<td>Loving Hut</td>
<td>Jungmannova</td>
<td>18</td>
<td>None</td>
<td>1.26504911848</td>
</tr>
<tr>
<td>296542635</td>
<td>Salé</td>
<td>Orebitská</td>
<td>194/14</td>
<td>None</td>
<td>1.37304931465</td>
</tr>
<tr>
<td>3188225062</td>
<td>Gouranga</td>
<td>None</td>
<td>None</td>
<td>None</td>
<td>1.4832202835</td>
</tr>
<tr>
<td>3615466837</td>
<td>Loving Hut</td>
<td>Neklanova</td>
<td>30</td>
<td>None</td>
<td>1.53952159764</td>
</tr>
<tr>
<td>3715489329</td>
<td>Zdravé žití u tří růží</td>
<td>Soukenická</td>
<td>1190/21</td>
<td>+420 222 318 726</td>
<td>1.87560233767</td>
</tr>
<tr>
<td>3346737424</td>
<td>Dharmasala</td>
<td>Peckova</td>
<td>None</td>
<td>None</td>
<td>1.90294241462</td>
</tr>
<tr>
<td>941177533</td>
<td>Mlsná kavka</td>
<td>None</td>
<td>None</td>
<td>+420777913054</td>
<td>1.90354046063</td>
</tr>
<tr>
<td>4009231866</td>
<td>Veggie Garden</td>
<td>None</td>
<td>None</td>
<td>None</td>
<td>1.92520166077</td>
</tr>
</tbody>
</table><h3 id="find-playgrounds"><a name="find-playgrounds" href="#find-playgrounds"></a>Find Playgrounds</h3><p>All parents who have small kids would like to know where the closest playgrounds are located. The following SQL query template can help with that. It selects fixed number (LIMIT_THRSH) of playgrounds closest to specified location (TRG_LAT, TRG_LON):</p><pre class="sql hljs"><code class="sql" data-origin="<pre><code class=&quot;sql&quot;>SELECT A.id,
       B.value AS playground,
       A.lt,
       A.ln,
       distance(A.lt, A.ln, TRG_LAT, TRG_LON) AS dist
FROM
  (SELECT wt.id,
          avg(n.lat) AS lt,
                        avg(n.lon) AS ln
   FROM ways w
   INNER JOIN
     (SELECT wn.id,
             n.lat,
             n.lon
      FROM ways_nodes wn
      INNER JOIN nodes n ON (wn.node_id = n.id) ) AS n ON (w.id = n.id)
   INNER JOIN ways_tags wt ON (w.id = wt.id
                               AND n.id=wt.id)
   WHERE wt.key=&quot;leisure&quot;
     AND wt.value=&quot;playground&quot;
   GROUP BY wt.id) A
LEFT JOIN ways_tags B ON (A.id = B.id
                          AND B.key=&quot;name&quot;)
ORDER BY dist LIMIT LIMIT_THRSH
</code></pre>"><span class="hljs-operator"><span class="hljs-keyword">SELECT</span> A.id,
       B.<span class="hljs-keyword">value</span> <span class="hljs-keyword">AS</span> playground,
       A.lt,
       A.<span class="hljs-keyword">ln</span>,
       distance(A.lt, A.<span class="hljs-keyword">ln</span>, TRG_LAT, TRG_LON) <span class="hljs-keyword">AS</span> dist
<span class="hljs-keyword">FROM</span>
  (<span class="hljs-keyword">SELECT</span> wt.id,
          <span class="hljs-keyword">avg</span>(n.lat) <span class="hljs-keyword">AS</span> lt,
                        <span class="hljs-keyword">avg</span>(n.lon) <span class="hljs-keyword">AS</span> <span class="hljs-keyword">ln</span>
   <span class="hljs-keyword">FROM</span> ways w
   <span class="hljs-keyword">INNER</span> <span class="hljs-keyword">JOIN</span>
     (<span class="hljs-keyword">SELECT</span> wn.id,
             n.lat,
             n.lon
      <span class="hljs-keyword">FROM</span> ways_nodes wn
      <span class="hljs-keyword">INNER</span> <span class="hljs-keyword">JOIN</span> nodes n <span class="hljs-keyword">ON</span> (wn.node_id = n.id) ) <span class="hljs-keyword">AS</span> n <span class="hljs-keyword">ON</span> (w.id = n.id)
   <span class="hljs-keyword">INNER</span> <span class="hljs-keyword">JOIN</span> ways_tags wt <span class="hljs-keyword">ON</span> (w.id = wt.id
                               <span class="hljs-keyword">AND</span> n.id=wt.id)
   <span class="hljs-keyword">WHERE</span> wt.<span class="hljs-keyword">key</span>=<span class="hljs-string">"leisure"</span>
     <span class="hljs-keyword">AND</span> wt.<span class="hljs-keyword">value</span>=<span class="hljs-string">"playground"</span>
   <span class="hljs-keyword">GROUP</span> <span class="hljs-keyword">BY</span> wt.id) A
<span class="hljs-keyword">LEFT</span> <span class="hljs-keyword">JOIN</span> ways_tags B <span class="hljs-keyword">ON</span> (A.id = B.id
                          <span class="hljs-keyword">AND</span> B.<span class="hljs-keyword">key</span>=<span class="hljs-string">"name"</span>)
<span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> dist <span class="hljs-keyword">LIMIT</span> LIMIT_THRSH
</span></code></pre><p>Example of 5 playgrounds closest to the metro station Náměstí Míru (LIMIT_THRSH=5, TRG_LAT=50.075104, TRG_LON=14.437783):</p><table>
<thead>
<tr>
<th>id</th>
<th>playground</th>
<th>lat</th>
<th>lon</th>
<th>dist(km)</th>
</tr>
</thead>
<tbody>
<tr>
<td>115511512</td>
<td>None</td>
<td>50.0725020625</td>
<td>14.44522195</td>
<td>0.604600014152</td>
</tr>
<tr>
<td>28254035</td>
<td>Horní hřiště</td>
<td>50.0706216333</td>
<td>14.4444128583</td>
<td>0.687232605664</td>
</tr>
<tr>
<td>284577445</td>
<td>U Vodárny</td>
<td>50.07587525</td>
<td>14.448337225</td>
<td>0.758041834989</td>
</tr>
<tr>
<td>278208918</td>
<td>U Draka</td>
<td>50.0809563789</td>
<td>14.4434010789</td>
<td>0.764330752018</td>
</tr>
<tr>
<td>337383525</td>
<td>None</td>
<td>50.0825131364</td>
<td>14.443435</td>
<td>0.917280558432</td>
</tr>
</tbody>
</table><h3 id="district-statistics"><a name="district-statistics" href="#district-statistics"></a>District Statistics</h3><p>Here are some statistics for different Prague districs. District number is extracted from the postcode.</p><pre class="sql hljs"><code class="sql" data-origin="<pre><code class=&quot;sql&quot;>SELECT PC.code,
       R.count_rest,
       P.count_bars,
       S.count_supermarkets,
       T.count_tourist
FROM
  (SELECT DISTINCT substr(value, 1, 2) AS code
   FROM nodes_tags
   WHERE KEY = &quot;postcode&quot;
     AND substr(value,1,1)=&quot;1&quot; ) PC
LEFT JOIN
  (SELECT substr(nt1.value,1,2) AS code,
                                   count(*) AS count_rest
   FROM nodes n
   INNER JOIN nodes_tags nt ON (n.id = nt.id)
   INNER JOIN nodes_tags nt1 ON (n.id = nt1.id)
   WHERE nt.KEY = &quot;amenity&quot;
     AND nt.value = &quot;restaurant&quot;
     AND nt1.KEY=&quot;postcode&quot;
   GROUP BY code ) R ON (PC.code = R.code)
LEFT JOIN
  (SELECT substr(nt1.value,1,2) AS code,
                                   count(*) AS count_bars
   FROM nodes n
   INNER JOIN nodes_tags nt ON (n.id = nt.id)
   INNER JOIN nodes_tags nt1 ON (n.id = nt1.id)
   WHERE nt.KEY = &quot;amenity&quot;
     AND (nt.value = &quot;pub&quot;
          OR nt.value=&quot;bar&quot;)
     AND nt1.KEY=&quot;postcode&quot;
   GROUP BY code ) P ON (PC.code = P.code)
LEFT JOIN
  (SELECT substr(nt1.value,1,2) AS code,
                                   count(*) AS count_supermarkets
   FROM nodes n
   INNER JOIN nodes_tags nt ON (n.id = nt.id)
   INNER JOIN nodes_tags nt1 ON (n.id = nt1.id)
   WHERE nt.KEY = &quot;shop&quot;
     AND nt.value = &quot;supermarket&quot;
     AND nt1.KEY=&quot;postcode&quot;
   GROUP BY code ) S ON (PC.code = S.code)
LEFT JOIN
  (SELECT substr(nt1.value,1,2) AS code,
                                   count(*) AS count_tourist
   FROM nodes n
   INNER JOIN nodes_tags nt ON (n.id = nt.id)
   INNER JOIN nodes_tags nt1 ON (n.id = nt1.id)
   WHERE nt.KEY = &quot;tourism&quot;
     AND nt1.KEY=&quot;postcode&quot;
   GROUP BY code ) T ON (PC.code = T.code)
</code></pre>"><span class="hljs-operator"><span class="hljs-keyword">SELECT</span> PC.code,
       R.count_rest,
       P.count_bars,
       S.count_supermarkets,
       T.count_tourist
<span class="hljs-keyword">FROM</span>
  (<span class="hljs-keyword">SELECT</span> <span class="hljs-keyword">DISTINCT</span> <span class="hljs-keyword">substr</span>(<span class="hljs-keyword">value</span>, <span class="hljs-number">1</span>, <span class="hljs-number">2</span>) <span class="hljs-keyword">AS</span> code
   <span class="hljs-keyword">FROM</span> nodes_tags
   <span class="hljs-keyword">WHERE</span> <span class="hljs-keyword">KEY</span> = <span class="hljs-string">"postcode"</span>
     <span class="hljs-keyword">AND</span> <span class="hljs-keyword">substr</span>(<span class="hljs-keyword">value</span>,<span class="hljs-number">1</span>,<span class="hljs-number">1</span>)=<span class="hljs-string">"1"</span> ) PC
<span class="hljs-keyword">LEFT</span> <span class="hljs-keyword">JOIN</span>
  (<span class="hljs-keyword">SELECT</span> <span class="hljs-keyword">substr</span>(nt1.<span class="hljs-keyword">value</span>,<span class="hljs-number">1</span>,<span class="hljs-number">2</span>) <span class="hljs-keyword">AS</span> code,
                                   <span class="hljs-keyword">count</span>(*) <span class="hljs-keyword">AS</span> count_rest
   <span class="hljs-keyword">FROM</span> nodes n
   <span class="hljs-keyword">INNER</span> <span class="hljs-keyword">JOIN</span> nodes_tags nt <span class="hljs-keyword">ON</span> (n.id = nt.id)
   <span class="hljs-keyword">INNER</span> <span class="hljs-keyword">JOIN</span> nodes_tags nt1 <span class="hljs-keyword">ON</span> (n.id = nt1.id)
   <span class="hljs-keyword">WHERE</span> nt.<span class="hljs-keyword">KEY</span> = <span class="hljs-string">"amenity"</span>
     <span class="hljs-keyword">AND</span> nt.<span class="hljs-keyword">value</span> = <span class="hljs-string">"restaurant"</span>
     <span class="hljs-keyword">AND</span> nt1.<span class="hljs-keyword">KEY</span>=<span class="hljs-string">"postcode"</span>
   <span class="hljs-keyword">GROUP</span> <span class="hljs-keyword">BY</span> code ) R <span class="hljs-keyword">ON</span> (PC.code = R.code)
<span class="hljs-keyword">LEFT</span> <span class="hljs-keyword">JOIN</span>
  (<span class="hljs-keyword">SELECT</span> <span class="hljs-keyword">substr</span>(nt1.<span class="hljs-keyword">value</span>,<span class="hljs-number">1</span>,<span class="hljs-number">2</span>) <span class="hljs-keyword">AS</span> code,
                                   <span class="hljs-keyword">count</span>(*) <span class="hljs-keyword">AS</span> count_bars
   <span class="hljs-keyword">FROM</span> nodes n
   <span class="hljs-keyword">INNER</span> <span class="hljs-keyword">JOIN</span> nodes_tags nt <span class="hljs-keyword">ON</span> (n.id = nt.id)
   <span class="hljs-keyword">INNER</span> <span class="hljs-keyword">JOIN</span> nodes_tags nt1 <span class="hljs-keyword">ON</span> (n.id = nt1.id)
   <span class="hljs-keyword">WHERE</span> nt.<span class="hljs-keyword">KEY</span> = <span class="hljs-string">"amenity"</span>
     <span class="hljs-keyword">AND</span> (nt.<span class="hljs-keyword">value</span> = <span class="hljs-string">"pub"</span>
          <span class="hljs-keyword">OR</span> nt.<span class="hljs-keyword">value</span>=<span class="hljs-string">"bar"</span>)
     <span class="hljs-keyword">AND</span> nt1.<span class="hljs-keyword">KEY</span>=<span class="hljs-string">"postcode"</span>
   <span class="hljs-keyword">GROUP</span> <span class="hljs-keyword">BY</span> code ) P <span class="hljs-keyword">ON</span> (PC.code = P.code)
<span class="hljs-keyword">LEFT</span> <span class="hljs-keyword">JOIN</span>
  (<span class="hljs-keyword">SELECT</span> <span class="hljs-keyword">substr</span>(nt1.<span class="hljs-keyword">value</span>,<span class="hljs-number">1</span>,<span class="hljs-number">2</span>) <span class="hljs-keyword">AS</span> code,
                                   <span class="hljs-keyword">count</span>(*) <span class="hljs-keyword">AS</span> count_supermarkets
   <span class="hljs-keyword">FROM</span> nodes n
   <span class="hljs-keyword">INNER</span> <span class="hljs-keyword">JOIN</span> nodes_tags nt <span class="hljs-keyword">ON</span> (n.id = nt.id)
   <span class="hljs-keyword">INNER</span> <span class="hljs-keyword">JOIN</span> nodes_tags nt1 <span class="hljs-keyword">ON</span> (n.id = nt1.id)
   <span class="hljs-keyword">WHERE</span> nt.<span class="hljs-keyword">KEY</span> = <span class="hljs-string">"shop"</span>
     <span class="hljs-keyword">AND</span> nt.<span class="hljs-keyword">value</span> = <span class="hljs-string">"supermarket"</span>
     <span class="hljs-keyword">AND</span> nt1.<span class="hljs-keyword">KEY</span>=<span class="hljs-string">"postcode"</span>
   <span class="hljs-keyword">GROUP</span> <span class="hljs-keyword">BY</span> code ) S <span class="hljs-keyword">ON</span> (PC.code = S.code)
<span class="hljs-keyword">LEFT</span> <span class="hljs-keyword">JOIN</span>
  (<span class="hljs-keyword">SELECT</span> <span class="hljs-keyword">substr</span>(nt1.<span class="hljs-keyword">value</span>,<span class="hljs-number">1</span>,<span class="hljs-number">2</span>) <span class="hljs-keyword">AS</span> code,
                                   <span class="hljs-keyword">count</span>(*) <span class="hljs-keyword">AS</span> count_tourist
   <span class="hljs-keyword">FROM</span> nodes n
   <span class="hljs-keyword">INNER</span> <span class="hljs-keyword">JOIN</span> nodes_tags nt <span class="hljs-keyword">ON</span> (n.id = nt.id)
   <span class="hljs-keyword">INNER</span> <span class="hljs-keyword">JOIN</span> nodes_tags nt1 <span class="hljs-keyword">ON</span> (n.id = nt1.id)
   <span class="hljs-keyword">WHERE</span> nt.<span class="hljs-keyword">KEY</span> = <span class="hljs-string">"tourism"</span>
     <span class="hljs-keyword">AND</span> nt1.<span class="hljs-keyword">KEY</span>=<span class="hljs-string">"postcode"</span>
   <span class="hljs-keyword">GROUP</span> <span class="hljs-keyword">BY</span> code ) T <span class="hljs-keyword">ON</span> (PC.code = T.code)
</span></code></pre><p>Query result:</p><table>
<thead>
<tr>
<th>District</th>
<th># Restaurants</th>
<th># Bars</th>
<th># Supermarkets</th>
<th># Tourist Objects</th>
</tr>
</thead>
<tbody>
<tr>
<td>10</td>
<td>60</td>
<td>13</td>
<td>4</td>
<td>10</td>
</tr>
<tr>
<td>11</td>
<td>327</td>
<td>56</td>
<td>12</td>
<td>171</td>
</tr>
<tr>
<td>12</td>
<td>122</td>
<td>37</td>
<td>4</td>
<td>75</td>
</tr>
<tr>
<td>13</td>
<td>15</td>
<td>6</td>
<td>1</td>
<td>6</td>
</tr>
<tr>
<td>14</td>
<td>66</td>
<td>13</td>
<td>6</td>
<td>9</td>
</tr>
<tr>
<td>15</td>
<td>88</td>
<td>29</td>
<td>3</td>
<td>8</td>
</tr>
<tr>
<td>16</td>
<td>52</td>
<td>10</td>
<td>8</td>
<td>13</td>
</tr>
<tr>
<td>17</td>
<td>26</td>
<td>8</td>
<td>5</td>
<td>5</td>
</tr>
<tr>
<td>18</td>
<td>21</td>
<td>11</td>
<td>2</td>
<td>5</td>
</tr>
<tr>
<td>19</td>
<td>19</td>
<td>9</td>
<td>1</td>
<td>2</td>
</tr>
</tbody>
</table><p>We can see that central districts like Prague 1(11) and Prague 2(12) have much more tourist objects, number of restaurants and bars is also higher than in other districts.</p><h2 id="conclusion"><a name="conclusion" href="#conclusion"></a>Conclusion</h2><p>The OpenStreetMap data provides a lot of useful information which can be incorporated into different projects and applications. However since this data is open for different contributors, it is prone to errors and requires careful cleaning.<br>In this project I have performed detailed audit of address information and  implemented a few cleaning strategies.</p><p>As an example I suggest using OpenStreepMap data for building a database of restaurants and other eating places.<br>Besides location and contacts it will also include information about outdoor seating areas, smoking and non-smoking areas, cuisine, opening hours and etc.<br>An application based on this database can be used for simple search by one or more criteria or search based on current location. Being connected to some rating resources (like trip adviser and others) it can also be used as a recommendation system.</p><p>The following tags will be useful in building restaurant database:</p><pre><code class="sh" data-origin="<pre><code class=&quot;sh&quot;>outdoor_seating=yes/no
leisure=outdoor_seating
smoking=*
cuisine=*
opening_hours=*
</code></pre>">outdoor_seating=yes/no
leisure=outdoor_seating
smoking=*
cuisine=*
opening_hours=*
</code></pre><p>Using ‘opening_hours’ tag actually is not straightforward. There is no standard format for this tag, so all cases should be parsed and standardized. More convenient approach is to create a separate table, which will include restaurant id, weekday, start_hour and end_hour.</p><p>Cuisine values are also should be standardized and possibly stored in a separate tables (one table will list all possible cuisines (cuisine id, cuisine name) and another table will link restaurant id and cuisine id)</p><p>Integration with rating resources will possibly raise a lot of problems. It can be quite complicated to match restaurants simply by name, so contact information may also be involved.</p><p>The real power behind such applications is the data it uses. The more detailed map data is available, the more helpful is the application. This application can also include an easy interface for inputting information about restaurants. This data than should be processed, cleaned, tagged and then added to OpenStreetMap database. This could engage more people in contribution process.</p>

@@footer
</body>
</html>
